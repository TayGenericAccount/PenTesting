#!/usr/bin/python

import sys, getopt
import logging
logging.getLogger("scapy.runtime").setLevel(logging.ERROR)
from scapy.all import *
import itertools


def main(argv):
	inputHost = ''
	inputPort = ''
	try:
   		#-h = help
   		#-i = host
   		#-p = port
		opts, args = getopt.getopt(argv,"hi:p:",["inputHostInfomration=","inputPortInformation="])
	except getopt.GetoptError:
		print 'test.py -i <inputHost> -o <inputPort>'
		sys.exit(2)
	for opt, arg in opts:
		if opt == '-h':
			print 'test.py -i <inputHost> -p <inputPort>'
			sys.exit()
		elif opt in ("-i", "--inputHostInfomration"):
			inputHost = arg
		elif opt in ("-p", "--inputPortInformation"):
			inputPort = arg
	scanner(inputHost, inputPort)
	print 'Input host is "', inputHost
	print 'Input port is "', inputPort


def scanner(ips, port):
	src_port = RandShort()
	dst_port = int(port)
	scan = sr1(IP(dst=ips)/TCP(sport=src_port,dport=dst_port,flags="S"),timeout=10)
	if scan is None:
	    print "This port is closed on IP: " + ips
	elif(scan.haslayer(TCP)):
	    if(scan.getlayer(TCP).flags==0x12):
	        print "This port is open for IP: " + ips
	else:
	    print "Unknown state"


if __name__ == "__main__":
	main(sys.argv[1:])
