#!/usr/bin/python

import sys, getopt
import logging
logging.getLogger("scapy.runtime").setLevel(logging.ERROR)
from scapy.all import *
import itertools


def main(argv):
	inputHost = '' 
	inputPort = '' 
	try:
   		#-h = help
   		#-i = host
   		#-p = port
		opts, args = getopt.getopt(argv,"hi:p:",["inputHostInfomration=","inputPortInformation="]) #This sets the flags with ":" after the flags with expected input
	except getopt.GetoptError: #Returns a string with the proper syntax if Getopt had an error reading the input
		print 'PortScanner.py -i <inputHost> -p <inputPort>'
		sys.exit(2)
	for opt, arg in opts:
		if opt == '-h': #Returns the help dialogue
			print 'PortScanner.py -i <inputHost> -p <inputPort>'
			sys.exit()
		elif opt in ("-i", "--inputHostInfomration"): #if there was a "-i" flag, it will set the inputHost variable with the host information
			inputHost = arg
		elif opt in ("-p", "--inputPortInformation"):#if there was a "-p" flag, it will set the inputPort variable
			inputPort = arg
	scanner(inputHost, inputPort) #Sends input information to the scanner function
	print 'Input host is "', inputHost
	print 'Input port is "', inputPort


def scanner(ips, port):
	src_port = RandShort() #Gives a random source port
	dst_port = int(port) #Sets the destination port as the port specified as an int
	scan = sr1(IP(dst=ips)/TCP(sport=src_port,dport=dst_port,flags="S"),timeout=10) #Using Scapey, this looks for the destination IP address, sets up the ports and flags, and times out after the specified time
	if scan is None: #If there is no return, it gives that the port is closed
	    print "This port is closed on IP: " + ips
	elif(scan.haslayer(TCP)): #If there is a returned TCP, then it states the port is open
	    if(scan.getlayer(TCP).flags==0x12):
	        print "This port is open for IP: " + ips
	else: #If it returns something unexpected, it prints that the state is unknown
	    print "Unknown state"


if __name__ == "__main__": #This starts the main function
	main(sys.argv[1:])
